// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Country {
  id        String   @id @default(cuid())
  name      String   @unique // "United States"
  slug      String   @unique // "united-states"
  code      String   @unique // "US"
  firms     Firm[]
  states    State[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
}

model State {
  id        String   @id @default(cuid())
  name      String   // "California"
  slug      String   // "california"
  code      String   // "CA"
  countryId String
  country   Country  @relation(fields: [countryId], references: [id])
  metros    Metro[]
  offices   Office[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([countryId, slug])
  @@index([slug])
  @@index([countryId])
}

model Metro {
  id        String   @id @default(cuid())
  name      String   // "San Francisco Bay Area"
  slug      String   // "san-francisco"
  stateId   String
  state     State    @relation(fields: [stateId], references: [id])
  offices   Office[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([stateId, slug])
  @@index([slug])
  @@index([stateId])
}

model PracticeArea {
  id                 String               @id @default(cuid())
  name               String               @unique // "Corporate Law"
  slug               String               @unique // "corporate-law"
  description        String?              @db.Text
  firms              FirmPracticeArea[]
  lawyers            LawyerPracticeArea[]
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt

  @@index([slug])
}

model Firm {
  id             String             @id @default(cuid())
  name           String             // "Cravath, Swaine & Moore LLP"
  slug           String             @unique // "cravath-swaine-moore"
  description    String?            @db.Text
  website        String?
  phone          String?
  founded        Int?
  employeeCount  Int?
  logoUrl        String?
  countryId      String
  country        Country            @relation(fields: [countryId], references: [id])

  // Relations
  offices        Office[]
  lawyers        Lawyer[]
  practiceAreas  FirmPracticeArea[]
  clientComments ClientComment[]

  // Rankings & Recognition
  overallRanking Int?
  tierLevel      Int?               // 1-5 tier system

  // Profile Status
  isActive       Boolean            @default(false)
  isPremium      Boolean            @default(false)

  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  @@index([slug])
  @@index([countryId])
  @@index([tierLevel])
  @@index([isPremium])
}

model Office {
  id         String   @id @default(cuid())
  firmId     String
  firm       Firm     @relation(fields: [firmId], references: [id], onDelete: Cascade)

  // Location
  stateId    String?
  state      State?   @relation(fields: [stateId], references: [id])
  metroId    String?
  metro      Metro?   @relation(fields: [metroId], references: [id])

  // Address details
  address    String
  city       String
  postalCode String?
  phone      String?

  isPrimary  Boolean  @default(false)

  lawyers    Lawyer[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([firmId])
  @@index([stateId])
  @@index([metroId])
}

model Lawyer {
  id              String               @id @default(cuid())
  firstName       String
  lastName        String
  slug            String               @unique // "john-smith-cravath"
  title           String?              // "Partner", "Associate"
  bio             String?              @db.Text
  email           String?
  phone           String?
  photoUrl        String?

  firmId          String
  firm            Firm                 @relation(fields: [firmId], references: [id], onDelete: Cascade)
  officeId        String?
  office          Office?              @relation(fields: [officeId], references: [id])

  practiceAreas   LawyerPracticeArea[]

  // Recognition
  isRecognized    Boolean              @default(false)
  recognitionTier Int?                 // 1-5
  yearsExperience Int?

  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([firmId])
  @@index([slug])
  @@index([isRecognized])
}

model FirmPracticeArea {
  id             String       @id @default(cuid())
  firmId         String
  firm           Firm         @relation(fields: [firmId], references: [id], onDelete: Cascade)
  practiceAreaId String
  practiceArea   PracticeArea @relation(fields: [practiceAreaId], references: [id], onDelete: Cascade)

  // Rankings for this practice area
  ranking        Int?
  tierLevel      Int?         // 1-5

  createdAt      DateTime     @default(now())

  @@unique([firmId, practiceAreaId])
  @@index([practiceAreaId])
  @@index([tierLevel])
}

model LawyerPracticeArea {
  id             String       @id @default(cuid())
  lawyerId       String
  lawyer         Lawyer       @relation(fields: [lawyerId], references: [id], onDelete: Cascade)
  practiceAreaId String
  practiceArea   PracticeArea @relation(fields: [practiceAreaId], references: [id], onDelete: Cascade)

  isPrimary      Boolean      @default(false)

  createdAt      DateTime     @default(now())

  @@unique([lawyerId, practiceAreaId])
  @@index([practiceAreaId])
}

model ClientComment {
  id          String   @id @default(cuid())
  firmId      String
  firm        Firm     @relation(fields: [firmId], references: [id], onDelete: Cascade)

  content     String   @db.Text
  clientName  String?  // Anonymous if null
  projectType String?  // "M&A Deal", "Litigation"
  year        Int?
  rating      Int?     // 1-5

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([firmId])
}

model Nomination {
  id                String   @id @default(cuid())

  // Nominator Information
  nominatorName     String
  nominatorEmail    String
  nominatorPhone    String?

  // Firm Information
  firmName          String
  firmWebsite       String?
  firmDescription   String?  @db.Text

  // Location
  city              String
  state             String
  address           String?

  // Practice Areas (stored as JSON array of strings)
  practiceAreas     String   @db.Text  // JSON array

  // Additional Info
  notes             String?  @db.Text

  // Status
  status            String   @default("pending")  // "pending", "approved", "rejected"
  reviewedBy        String?
  reviewedAt        DateTime?
  rejectionReason   String?  @db.Text

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

model Page {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String   @db.Text
  metaTitle   String?
  metaDesc    String?  @db.Text
  published   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([published])
}

model BlogPost {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  excerpt     String?  @db.Text
  content     String   @db.Text
  coverImage  String?
  author      String   @default("Admin")
  published   Boolean  @default(false)
  publishedAt DateTime?
  metaTitle   String?
  metaDesc    String?  @db.Text
  tags        String?  @db.Text  // JSON array
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([published])
  @@index([publishedAt])
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed password
  firstName String?
  lastName  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}

model Lead {
  id           String   @id @default(cuid())
  firstName    String
  lastName     String
  email        String
  company      String?
  jobTitle     String?
  phone        String?
  source       String   @default("legal-market-analysis") // Which resource they downloaded
  createdAt    DateTime @default(now())

  @@index([email])
  @@index([source])
  @@index([createdAt])
}
